{"componentChunkName":"component---src-templates-blog-post-js","path":"/blogs/how-to-build-middle-scaled-react-app","result":{"data":{"markdownRemark":{"html":"<p>There are already quite a lot of medium tutorials teaching people out there for how to make a proper react application using react + redux stack. And people even developed some great ideas like <a href=\"https://dvajs.com/\">dva</a> to reduce boilerplate and pain to setup the whole stack.</p>\n<p><a href=\"https://dvajs.com/\">dva</a> is really nice, I loved the concept of it so much, It reminds me of ruby on rails a few years ago. However, besides the great benefits full-featured store management libraries could provide us, it has it's own shorthands as well.</p>\n<ol>\n<li>libs like <a href=\"https://dvajs.com/\">dva</a> is a bit over-encapsulated. so new joiner hardly know how does this magically work unless he/she spend quite sometime doing todo-lists following another tutorial.</li>\n<li>Modularity design is not straight forward. e.g. user as a module, orders as a module etc. It seems very ideal, you could even do code splitting by doing this, and only load necessary reducers / sagas whenever necessary. But in the end module-module will become a headache.</li>\n<li>Modularity design does not fit \"page centric\" designs. It turns out that in medium sized application, people are more focused on \"What will this page do\" rather than \"what will this chunk of section in the page will do\".</li>\n<li>Cannot find a way to integrate with other popular libraries. e.g. redux-form</li>\n</ol>\n<p>So what's the solution?</p>\n<p>Well, we could use all small pieces of react ecosystem to build the suitable framework of our own! The process is super hard, but finally I have found a way to keep everything under control.</p>\n<p>TL;DR; Here are a few key take-aways:</p>\n<ol>\n<li>Use sock drawer design rather than modular design for your store and folder structure</li>\n<li>Put route configs in one file</li>\n<li>Generalise restful http calls by \"resource\"</li>\n<li>Control the flow using redux-saga</li>\n<li>If you encountered any form, just use redux-form. Trust me.</li>\n<li>Use url to control page state as much as possible</li>\n<li>Control # of action types and reducers being mounted to the rootReducer.</li>\n</ol>\n<p>Project Layout</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">app\n├── Root.jsx\n├── actions\n│   ├── loading.js\n│   ├── messages.js\n│   ├── queryParams.js\n│   ├── resources.js\n│   └── user.js\n├── app.jsx\n├── components\n│   ├── Bundle\n│   ├── Form\n│   ├── Comonent1\n│   ├── Comonent2\n│   └── Message\n├── constants\n│   ├── ActionTypes.js\n│   ├── Forms.js\n│   ├── Loadings.js\n│   ├── Modals.js\n│   ├── Resources.js\n├── pages\n│   ├── DashboardPage\n│   ├── OrdersPage\n│   ├── AuthPages\n│   └── NotFound\n├── polyfill.js\n├── reducers\n│   ├── index.js\n│   ├── loadings.js\n│   ├── messages.js\n│   └── resources\n├── sagas\n│   ├── resource.js\n│   ├── auth\n│   ├── index.js\n├── selectors\n│   ├── getResource.js\n│   ├── getResources.js\n│   ├── getSearch.js\n│   └── isLoading.js\n├── stores\n│   └── index.js\n├── styles\n│   ├── breakpoints.scss\n│   └── variables.scss\n└── utils\n    ├── network.js\n    └── redirect.js</code></pre></div>\n<p>as shown in the gist above, the project structure is purely sock drawer design.\nThere is one folder that is quite interesting: pages folder. This is quite similar t the traditional containers folder if you came from the redux-todo-list tutorial. They are very similar, just differs in a few aspects:</p>\n<ol>\n<li>allow non-container components to be presented in this folder. We found that some top level page components may not needed to do anything with connect HoC</li>\n<li>nest a components folder inside the page folder, allowing further splitting logic.</li>\n<li>default component being split out of the page component to become a private component of that page.</li>\n</ol>\n<p>Here is a further folder structure i usually apply in the pages folder.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">app/pages\n├── AppPages\n│   ├── Layout.jsx\n│   ├── Dashboard\n│   │   ├── Dashboard.jsx\n│   │   ├── Dashboard.scss\n│   │   ├── __tests__\n│   │   │   ├── Dashboard.spec.jsx\n│   │   │   └── __snapshots__\n│   │   └── index.js\n│   ├── __tests__\n│   │   └── Layout.spec.jsx\n│   └── components\n│       ├── ToastMessages\n│       │   ├── Messages.jsx\n│       │   ├── Messages.scss\n│       │   ├── __test__\n│       │   └── index.js\n│       └── TopNavbar\n│           ├── TopNavbar.jsx\n│           └── index.js\n├── AuthPages\n│   ├── Layout.jsx\n│   ├── Layout.scss\n│   ├── AuthPages.scss\n│   ├── ForgotPassword\n│   │   ├── ForgotPassword.jsx\n│   │   ├── ForgotPasswordForm.jsx\n│   │   ├── __tests__\n│   │   │   ├── ForgotPassword.spec.jsx\n│   │   │   ├── ForgotPasswordForm.spec.jsx\n│   │   │   └── __snapshots__\n│   │   └── index.js\n│   ├── Login\n│   │   ├── Login.jsx\n│   │   ├── LoginForm.jsx\n│   │   ├── __tests__\n│   │   │   ├── Login.spec.jsx\n│   │   │   ├── LoginForm.spec.jsx\n│   │   │   └── __snapshots__\n│   │   └── index.js\n│   ├── Register\n│   │   ├── Register.jsx\n│   │   ├── RegisterForm.jsx\n│   │   ├── __tests__\n│   │   │   ├── Register.spec.jsx\n│   │   │   ├── RegisterForm.spec.jsx\n│   │   │   └── __snapshots__\n│   │   └── index.js\n│   ├── ResetPassword\n│   │   ├── ResetPassword.jsx\n│   │   ├── ResetPasswordForm.jsx\n│   │   └── index.js\n│   ├── VerifyEmail\n│   │   ├── VerifyEmail.jsx\n│   │   ├── __tests__\n│   │   │   ├── VerifyEmail.spec.jsx\n│   │   │   └── __snapshots__\n│   │   └── index.js\n│   └── components\n│       └── CollapsibleMessages\n│           ├── CollapsibleMessages.jsx\n│           └── index.js\n└── NotFound\n    ├── NotFound.jsx\n    ├── __tests__\n    │   └── NotFound.spec.jsx\n    └── index.js</code></pre></div>\n<p>In real life, we wanted to encourage to group similar functionalities using components. But here is an embarrassing situation:</p>\n<ol>\n<li>some of the components is specific to a page</li>\n<li>some of the components need to access to store</li>\n<li>some of the components need to access URL</li>\n</ol>\n<p>I would say any component falls fit into a use-case of those 3 categories, it indicates the component should be place in the pages folder. Based on a simple rule: make private first, then protected, finally public.</p>\n<ol>\n<li>if a component is only used by a page, put that in pages/XXXPage/components folder</li>\n<li>if a component is being shared by 2 pages, extra 1 layer up to the top. pages/components</li>\n<li>if a component is being shared by 3 pages, and not accessing the store, put it in the app/components folder.</li>\n</ol>\n<p>I found that following those simple rules make our application much readable, and encourage engineers to split more. Previously when we did not have this rules built in, i found that we easily achieve a 1000 lines container components which is absolutely horrible…</p>\n<p>In such case, to do code splitting is relatively simpler as well. Because each folder has it's own index.js, you could choose to use react-lodable</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">loader<span class=\"token punctuation\">,</span> loaderProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">Loadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./Dashboard'</span> <span class=\"token comment\">/* webpackChunkName: \"dashboard-page\" */</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">loading</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token operator\">&lt;</span>Loading <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>props<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Route Config\nReact-routerv4 enables us to write routes in a very flexible way. It unlocks the power of extremely modular way to do routing. But in my personal experience, I found that gathering all route config in one single file is much easier for new comers / looking back into an old project to get all the routes.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>Router history<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>history<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Switch<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Route path<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span> exact component<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>Welcome<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Route path<span class=\"token operator\">=</span><span class=\"token string\">\"/register\"</span> exact component<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>Register<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Route path<span class=\"token operator\">=</span><span class=\"token string\">\"/login\"</span> exact component<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>Login<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Route path<span class=\"token operator\">=</span><span class=\"token string\">\"/forgot-password\"</span> exact component<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>ForgotPassword<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Route path<span class=\"token operator\">=</span><span class=\"token string\">\"/verify-email\"</span> exact component<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>VerifyEmail<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Route path<span class=\"token operator\">=</span><span class=\"token string\">\"/reset-password\"</span> exact component<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>ResetPassword<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Route path<span class=\"token operator\">=</span><span class=\"token string\">\"/dashboard\"</span> component<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>Dashboard<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Route path<span class=\"token operator\">=</span><span class=\"token string\">\"/orders\"</span> exact component<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>Orders<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Route path<span class=\"token operator\">=</span><span class=\"token string\">\"/orders/:id\"</span> exact component<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>OrderDetail<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Route component<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>NotFound<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Switch<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Router<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>In such way it's crystal clear that what feature is enabled in the application.</p>\n<h2>Resources</h2>\n<p>GraphQL is already out there for a while. I think up to this moment, if you are building an application from scratch, you should strongly consider use graphQL as the server/frontend interface.\nHowever, not all applications have this luxury of using graphQL, most of the legacy projects still need to utilise good old restful API.\nSo if your restful API has some consistent convention, it'll be best to find a way to generalise it.\n90% of the cases, typical request goes through those steps</p>\n<ol>\n<li>resource request (from componentDidMountor handleClick etc.)</li>\n<li>start loading</li>\n<li>make the request</li>\n<li>display a toast message (success / failure)</li>\n<li>handle global http response error based on error code if there were an error</li>\n<li>tell store that resource is fetched and need to run reducer to update the store</li>\n<li>end loading</li>\n<li>component need to select the resource / loading status out of the store using selector</li>\n</ol>\n<p>We could see that step 1, 2, 4, 6, 7 clearly needs an action attached to them.</p>\n<p>Therefore i invented this concept called resources to systematically handle those common actions.</p>\n<p>First i will create a file named constant/Resources.js , I will give each resource a name. But as we could see, each resource actually have at least 5 actions related. Here comes a very small yet handy utility: makeResource .</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">makeResource</span><span class=\"token punctuation\">(</span>resource<span class=\"token punctuation\">,</span> opts <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> resourceUpper <span class=\"token operator\">=</span> resource<span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> resourceConstants <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token constant\">RESOURCE</span><span class=\"token punctuation\">:</span> resource<span class=\"token punctuation\">,</span>\n    <span class=\"token constant\">LOADING</span><span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>resourceUpper<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">_LOADING</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token constant\">CLEAR</span><span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">CLEAR_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>resourceUpper<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>opts<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'C'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span>resourceConstants<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token constant\">CREATE_DONE</span><span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">CREATE_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>resourceUpper<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">_DONE</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token constant\">CREATE_REQUEST</span><span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">CREATE_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>resourceUpper<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">_REQUEST</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>opts<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'R'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span>resourceConstants<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token constant\">FETCH_DONE</span><span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">FETCH_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>resourceUpper<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">_DONE</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token constant\">FETCH_REQUEST</span><span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">FETCH_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>resourceUpper<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">_REQUEST</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>opts<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'U'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span>resourceConstants<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token constant\">UPDATE_DONE</span><span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">UPDATE_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>resourceUpper<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">_DONE</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token constant\">UPDATE_REQUEST</span><span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">UPDATE_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>resourceUpper<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">_REQUEST</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>opts<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'D'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span>resourceConstants<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token constant\">DELETE_DONE</span><span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">DELETE_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>resourceUpper<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">_DONE</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token constant\">DELETE_REQUEST</span><span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">DELETE_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>resourceUpper<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">_REQUEST</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> resourceConstants\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>to use it, just do sth like</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">ORDERS</span> <span class=\"token operator\">=</span> <span class=\"token function\">makeResource</span><span class=\"token punctuation\">(</span><span class=\"token string\">'order'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CRUD'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// {</span>\n<span class=\"token comment\">//   RESOURCE: 'order',</span>\n<span class=\"token comment\">//   FETCH_REQUEST: 'FETCH_ORDER_REQUEST',</span>\n<span class=\"token comment\">//   FETCH_DONE: 'FETCH_ORDER_DONE',</span>\n<span class=\"token comment\">//   CREATE_REQUEST: 'FETCH_ORDER_DONE',</span>\n<span class=\"token comment\">//   CREATE_DONE: 'CREATE_ORDER_DONE',</span>\n<span class=\"token comment\">//   UPDATE_REQUEST: 'UPDATE_ORDER_DONE',</span>\n<span class=\"token comment\">//   UPDATE_DONE: 'UPDATE_ORDER_DONE',</span>\n<span class=\"token comment\">//   DELETE_REQUEST: 'DELETE_ORDER_DONE',</span>\n<span class=\"token comment\">//   DELETE_DONE: 'DELETE_ORDER_DONE',</span>\n<span class=\"token comment\">// }</span></code></pre></div>\n<p>next, we need to have a suite of generic actions that will accept those special constants</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">update</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">resource</span> <span class=\"token operator\">=></span> <span class=\"token parameter\">payload</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  type<span class=\"token punctuation\">:</span> resource<span class=\"token punctuation\">.</span><span class=\"token constant\">UPDATE_REQUEST</span><span class=\"token punctuation\">,</span>\n  payload<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\nupdate<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">done</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">resource</span> <span class=\"token operator\">=></span> <span class=\"token parameter\">payload</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  type<span class=\"token punctuation\">:</span> resource<span class=\"token punctuation\">.</span><span class=\"token constant\">UPDATE_DONE</span><span class=\"token punctuation\">,</span>\n  payload<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">create</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">resource</span> <span class=\"token operator\">=></span> <span class=\"token parameter\">payload</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  type<span class=\"token punctuation\">:</span> resource<span class=\"token punctuation\">.</span><span class=\"token constant\">CREATE_REQUEST</span><span class=\"token punctuation\">,</span>\n  payload<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\ncreate<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">done</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">resource</span> <span class=\"token operator\">=></span> <span class=\"token parameter\">payload</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  type<span class=\"token punctuation\">:</span> resource<span class=\"token punctuation\">.</span><span class=\"token constant\">CREATE_DONE</span><span class=\"token punctuation\">,</span>\n  payload<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">remove</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">resource</span> <span class=\"token operator\">=></span> <span class=\"token parameter\">payload</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  type<span class=\"token punctuation\">:</span> resource<span class=\"token punctuation\">.</span><span class=\"token constant\">DELETE_REQUEST</span><span class=\"token punctuation\">,</span>\n  payload<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\nremove<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">done</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">resource</span> <span class=\"token operator\">=></span> <span class=\"token parameter\">payload</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  type<span class=\"token punctuation\">:</span> resource<span class=\"token punctuation\">.</span><span class=\"token constant\">DELETE_DONE</span><span class=\"token punctuation\">,</span>\n  payload<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetch</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">resource</span> <span class=\"token operator\">=></span> <span class=\"token parameter\">payload</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  type<span class=\"token punctuation\">:</span> resource<span class=\"token punctuation\">.</span><span class=\"token constant\">FETCH_REQUEST</span><span class=\"token punctuation\">,</span>\n  payload<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\nfetch<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">done</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">resource</span> <span class=\"token operator\">=></span> <span class=\"token parameter\">payload</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  type<span class=\"token punctuation\">:</span> resource<span class=\"token punctuation\">.</span><span class=\"token constant\">FETCH_DONE</span><span class=\"token punctuation\">,</span>\n  payload<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">clear</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">resource</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  type<span class=\"token punctuation\">:</span> resource<span class=\"token punctuation\">.</span><span class=\"token constant\">CLEAR</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>for the reducer, actually it's quite easy to generalize as well, but the detailed implementation is related to how the restful API is being designed, so i will make a very extensible reducer</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> combineReducers <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'redux'</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> resources <span class=\"token keyword\">from</span> <span class=\"token string\">'app/constants/Resources'</span>\n\n<span class=\"token keyword\">import</span> order <span class=\"token keyword\">from</span> <span class=\"token string\">'./order'</span>\n\n<span class=\"token keyword\">const</span> extensions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>resources<span class=\"token punctuation\">.</span><span class=\"token constant\">CONNECTION</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> order<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> resourceReducers <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>resources<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">acc<span class=\"token punctuation\">,</span> cur</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> resource <span class=\"token operator\">=</span> resources<span class=\"token punctuation\">[</span>cur<span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>resource<span class=\"token punctuation\">.</span><span class=\"token constant\">FETCH_DONE</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    acc<span class=\"token punctuation\">[</span>resource<span class=\"token punctuation\">.</span><span class=\"token constant\">RESOURCE</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">createResourceReducer</span><span class=\"token punctuation\">(</span>\n      resource<span class=\"token punctuation\">,</span>\n      extensions<span class=\"token punctuation\">[</span>resource<span class=\"token punctuation\">.</span><span class=\"token constant\">RESOURCE</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    acc<span class=\"token punctuation\">[</span>resource<span class=\"token punctuation\">.</span><span class=\"token constant\">RESOURCE</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> extensions<span class=\"token punctuation\">[</span>resource<span class=\"token punctuation\">.</span><span class=\"token constant\">RESOURCE</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> acc\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">combineReducers</span><span class=\"token punctuation\">(</span>resourceReducers<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">createResourceReducer</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resource<span class=\"token punctuation\">,</span> extension</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">FETCH_DONE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CLEAR</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> resource\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">reducer</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> action</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// those actions are ensured to be in the resource</span>\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">case</span> <span class=\"token constant\">FETCH_DONE</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> action<span class=\"token punctuation\">.</span>payload\n      <span class=\"token keyword\">case</span> <span class=\"token constant\">CLEAR</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> extension <span class=\"token operator\">?</span> <span class=\"token function\">extension</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> state\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In reality, the API that responses data could be quite different, so a very flexible and pluggable reducer is needed here.\nIn components, upon dispatching a request, you just simply do this.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span><span class=\"token function\">fetchOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  fetchOrder<span class=\"token punctuation\">:</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>Order<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>YourComponent<span class=\"token punctuation\">)</span></code></pre></div>\n<p>this vastly simplified the tedious job to have a dedicated action type for FETCH<em>ORDER</em>REQUEST and attach an useless action fetchOrderRequestfor it.</p>\n<h2>redux-saga</h2>\n<p>we have covered the content resource in the previous section. It seems like the we need a tool to control the call sequence and centralised management of it. Therefore we need redux-saga\nWith the powerful resource concept, the flow we mentioned above is really easy</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> put<span class=\"token punctuation\">,</span> call<span class=\"token punctuation\">,</span> fork <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'redux-saga/effects'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> takeLatest <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'redux-saga'</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> addMessage <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'app/actions/messages'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> startLoading<span class=\"token punctuation\">,</span> endLoading <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'app/actions/loading'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">ORDER</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'app/constants/Resources'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> fetch <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'app/actions/resources'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> apiClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'app/utils/network'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">fetchOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">yield</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token function\">startLoading</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ORDER</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> error<span class=\"token punctuation\">,</span> payload <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">yield</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span>apiClient<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    method<span class=\"token punctuation\">:</span> <span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span>\n    url<span class=\"token punctuation\">:</span> <span class=\"token string\">'/api/order/'</span> <span class=\"token operator\">+</span> action<span class=\"token punctuation\">.</span>payload<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">yield</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span>\n      <span class=\"token function\">addMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        style<span class=\"token punctuation\">:</span> <span class=\"token string\">'danger'</span><span class=\"token punctuation\">,</span>\n        message<span class=\"token punctuation\">:</span> payload<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">,</span>\n        details<span class=\"token punctuation\">:</span> payload<span class=\"token punctuation\">.</span>details<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">yield</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span>fetch<span class=\"token punctuation\">.</span><span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ORDER</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">yield</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token function\">endLoading</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ORDER</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">yield</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span>takeLatest<span class=\"token punctuation\">,</span> <span class=\"token constant\">ORDER</span><span class=\"token punctuation\">.</span><span class=\"token constant\">FETCH_REQUEST</span><span class=\"token punctuation\">,</span> fetchOrder<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>loud and clear</p>\n<h2>redux-form</h2>\n<p>When it comes to form, usually it's very complicated using react. However, redux-form ease the pain.\nhere is a complete example of how a form could be handled together with redux-form. I won't be going through the details in redux-form usages</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> PureComponent <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword\">import</span> PropTypes <span class=\"token keyword\">from</span> <span class=\"token string\">'prop-types'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Form <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-bootststrap'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> connect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-redux'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> reduxForm<span class=\"token punctuation\">,</span> Field <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'redux-form'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Link <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-router-dom'</span>\n\n<span class=\"token keyword\">import</span> isLoading <span class=\"token keyword\">from</span> <span class=\"token string\">'app/selectors/isLoading'</span>\n<span class=\"token keyword\">import</span> getResource <span class=\"token keyword\">from</span> <span class=\"token string\">'app/selectors/getResource'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">USER</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'app/constants/Resources'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">PROFILE_FORM</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'app/constants/Forms'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> fetch<span class=\"token punctuation\">,</span> update <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'app/actions/resources'</span>\n\n<span class=\"token keyword\">import</span> gridFormGroup <span class=\"token keyword\">from</span> <span class=\"token string\">'app/components/Form/gridFormGroup'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> InputField <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'app/components/Form/ReduxFormFields'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> email<span class=\"token punctuation\">,</span> maxLength<span class=\"token punctuation\">,</span> required <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'app/components/Form/validators'</span>\n\n<span class=\"token keyword\">const</span> InputGroup <span class=\"token operator\">=</span> <span class=\"token function\">gridFormGroup</span><span class=\"token punctuation\">(</span>InputField<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> validateEmail <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token function\">required</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Invalid email'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">email</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Invalid email'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">maxLength</span><span class=\"token punctuation\">(</span><span class=\"token number\">254</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">const</span> validateName <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token function\">maxLength</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">AccountProfileForm</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">PureComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">static</span> propTypes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    fetchUser<span class=\"token punctuation\">:</span> PropTypes<span class=\"token punctuation\">.</span>func<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n    handleSubmit<span class=\"token punctuation\">:</span> PropTypes<span class=\"token punctuation\">.</span>func<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span><span class=\"token function\">fetchUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Form</span></span> <span class=\"token attr-name\">horizontal</span> <span class=\"token attr-name\">onSubmit</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>handleSubmit<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Field</span></span>\n          <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token attr-name\">validate</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>validateName<span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">maxLength</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>200<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token attr-name\">component</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>InputGroup<span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">label</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Full Name<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>(Optional)<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Field</span></span>\n          <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token attr-name\">validate</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>validateEmail<span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">component</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>InputGroup<span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">maxLength</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>254<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token attr-name\">info</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Email address<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token attr-name\">required</span>\n          <span class=\"token attr-name\">label</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Email<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Field</span></span>\n          <span class=\"token attr-name\">disabled</span>\n          <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token attr-name\">component</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>InputGroup<span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">info</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Link</span></span> <span class=\"token attr-name\">to</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/edit-password<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Change Password</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Link</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">label</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Password<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>• • • • • • • •<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Form</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">initialValues</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">user</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  name<span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span>\n  email<span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">.</span>email<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">transformPayload</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">formData</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  name<span class=\"token punctuation\">:</span> formData<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span>\n  email<span class=\"token punctuation\">:</span> formData<span class=\"token punctuation\">.</span>email<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">mapStatesToProps</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">state</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  isLoading<span class=\"token punctuation\">:</span> <span class=\"token function\">isLoading</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">,</span> <span class=\"token constant\">USER</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  initialValues<span class=\"token punctuation\">:</span> <span class=\"token function\">initialValues</span><span class=\"token punctuation\">(</span><span class=\"token function\">getResource</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">,</span> <span class=\"token constant\">USER</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> mapDispatchToProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">onSubmit</span><span class=\"token punctuation\">:</span> <span class=\"token parameter\">formData</span> <span class=\"token operator\">=></span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token constant\">USER</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token function\">transformPayload</span><span class=\"token punctuation\">(</span>formData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  fetchUser<span class=\"token punctuation\">:</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token constant\">USER</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>\n  mapStatesToProps<span class=\"token punctuation\">,</span>\n  mapDispatchToProps\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>\n  <span class=\"token function\">reduxForm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    enableReinitialize<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    form<span class=\"token punctuation\">:</span> <span class=\"token constant\">PROFILE_FORM</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>AccountProfileForm<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>url-based state</h2>\n<ol>\n<li>usually when an action is taken, we need to display some intermediate UI element to let the user perform some actions. We found that for cases like\nopen /close modal</li>\n<li>tab change</li>\n<li>filter change in a list page</li>\n</ol>\n<p>it will be the best to purely use URL to control them</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Route</span></span> <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/orders/:id/delete<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">exact</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> match <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DeleteOrderModal</span></span>\n        <span class=\"token attr-name\">show</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">Boolean</span><span class=\"token punctuation\">(</span>match<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">connection</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">:</span> match <span class=\"token operator\">&amp;&amp;</span> match<span class=\"token punctuation\">.</span>params <span class=\"token operator\">&amp;&amp;</span> match<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">.</span>id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n      <span class=\"token punctuation\">/></span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Route</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>In such case, to open the modal, you just point the user to specific route, no hassle at all, and it's completely under control</p>\n<h2>store management</h2>\n<p>with all of the concept and tips above, actually we have made our store very clean… normally the store will look like this</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">combineReducers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  form<span class=\"token punctuation\">,</span>\n  loadings<span class=\"token punctuation\">,</span>\n  messages<span class=\"token punctuation\">,</span>\n  router<span class=\"token punctuation\">,</span>\n  resources<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>","frontmatter":{"title":"Tips for making a mid-scale react application"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/blogs/how-to-build-middle-scaled-react-app"}}}