{"componentChunkName":"component---src-templates-blog-post-js","path":"/blogs/javascript-102","result":{"data":{"markdownRemark":{"html":"<p>JavaScript is essential to companies using <code class=\"language-text\">Node.js</code>. It's THE language of year 2016. However, it is also a fragile language could be easily abused.</p>\n<h2>Road toward clean code (less bug)</h2>\n<p>In this article, I am going to demonstrate some best practices in JavaScript with examples.</p>\n<h2><code class=\"language-text\">sum</code> function</h2>\n<p>To begin with, we are required to write a simple sum function. Here is the requirement:</p>\n<ol>\n<li>the function accepts <strong>1</strong> argument - an array of numbers</li>\n<li>the function should return the sum of all the numbers inside the array</li>\n</ol>\n<h3>for loop (not recommended)</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// array = [1,2,3,4]</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">array</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> array<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    result <span class=\"token operator\">+=</span> array<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> result\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The first approach is intuitive: use traditional <code class=\"language-text\">for</code> loop. There is nothing wrong about it, but as a js developer, we could do better.</p>\n<h3>for ... in loop (<strong>DEPRECATED</strong>, DO NOT USE)</h3>\n<p>And here is the famous <code class=\"language-text\">foo ... in</code> loop.</p>\n<p>As you can see, the obvious drawback of <code class=\"language-text\">for ... in</code> loop is that it could iterate over all of the keys and all the keys on it's prototype chain inside an object (array is also an object in js), therefore we have this <code class=\"language-text\">hasOwnProperty</code> check.</p>\n<p>an astonishing fact is that a lot of programmers from other languages really love this approach... However, the cold fact is due to the cumbersome <code class=\"language-text\">hasOwnProperty</code> check, <code class=\"language-text\">for ... in</code> loop is seldom used in most of the <code class=\"language-text\">Node.js</code> project, and even considered bad practice when iterate over a collection.</p>\n<p>Here is the reason:</p>\n<blockquote>\n<p>The for-in statement by itself is not a \"bad practice\", however it can be mis-used, for example, to iterate over arrays or array-like objects.</p>\n</blockquote>\n<blockquote>\n<p>The purpose of the for-in statement is to enumerate over object properties. This statement will go up in the prototype chain, also enumerating over inherited properties, a thing that sometimes is not desired.</p>\n</blockquote>\n<blockquote>\n<p>Also, the order of iteration is not guaranteed by the spec., meaning that if you want to \"iterate\" an array object, with this statement you cannot be sure that the properties (array indexes) will be visited in the numeric order.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// array = [1,2,3,4]</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">array</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> index <span class=\"token keyword\">in</span> array<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>array<span class=\"token punctuation\">.</span><span class=\"token function\">hasOwnProperty</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      result <span class=\"token operator\">+=</span> array<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> result\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>If one should iterate over every property in an <code class=\"language-text\">object</code> (<code class=\"language-text\">{}</code>) rather than <code class=\"language-text\">array</code> (<code class=\"language-text\">[]</code>), consider use those methods:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Object<span class=\"token punctuation\">.</span>keys           <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span><span class=\"token operator\">></span> _<span class=\"token punctuation\">.</span>keys\nObject<span class=\"token punctuation\">.</span><span class=\"token function\">values</span>  <span class=\"token punctuation\">(</span>es7<span class=\"token punctuation\">)</span>  <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span><span class=\"token operator\">></span> _<span class=\"token punctuation\">.</span>values\nObject<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span> <span class=\"token punctuation\">(</span>es7<span class=\"token punctuation\">)</span>  <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span><span class=\"token operator\">></span> _<span class=\"token punctuation\">.</span>pairs</code></pre></div>\n<p>Those methods are not following the prototype chain to do an exhaustive search so they may even have better performance compared to the <code class=\"language-text\">for ... in</code> loop.</p>\n<h3>for ... of loop (es6) (Okay.. not the best)</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// array = [1,2,3,4]</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">array</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> number <span class=\"token keyword\">of</span> array<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    result <span class=\"token operator\">+=</span> number\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> result\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>this is a more recommended way to iterate a collection (or iterable to be precise).</p>\n<p><code class=\"language-text\">for ... of</code> will not follow the prototype chain as well, because it can only be used on <code class=\"language-text\">iterable object</code>. And <code class=\"language-text\">Array</code> in es6 is implemented as an iterable. <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators\">iterable-mdn</a></p>\n<h3>Array.prototype.forEach (Okay, not the best)</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// array = [1,2,3,4]</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">array</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  array<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">number</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">+=</span> number<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> result\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Nothing wrong about it, but we still need a <code class=\"language-text\">result</code> tmp var.</p>\n<h3>Array.prototype.reduce (better)</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// array = [1,2,3,4]</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">array</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> array<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">pre<span class=\"token punctuation\">,</span> cur</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> pre <span class=\"token operator\">+</span> cur\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>this it the killer function of javascript, reduce function simply turns a <code class=\"language-text\">collection</code> in to a single value.</p>\n<div class=\"tip\">\nRemember, you MUST return the accumulated result in the reducer function\n</div>\n<p>We finally get rid of the annoying tmp var <code class=\"language-text\">result</code>! Yeal~</p>\n<h3>_.sum (best)</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// array = [1,2,3,4]</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">array</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">sum</span><span class=\"token punctuation\">(</span>array<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The real killer in JavaScript is the <code class=\"language-text\">lodash</code> library. It has became the de-factor JavaScript utility library. So Whenever you starts to write a function, the first thing to come up is always:</p>\n<p>can i achieve it in lodash?</p>\n<p>can i achieve it in lodash?</p>\n<p>can i achieve it in lodash?</p>\n<p>(have to repeat 3 times to emphersize important things)</p>\n<div class=\"tip\">\nAlways exploring lodash for data transformation tasks\n</div>\n<h2><code class=\"language-text\">clean</code> function</h2>\n<p>consider the <code class=\"language-text\">clean</code> function here:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ['tag1', 'tag2', 'tag1  '] -> ['tag1', 'tag2']</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">clean</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tags</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> dedupe <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> tags<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    tags<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> tags<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> aTag <span class=\"token operator\">=</span> tags<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>dedupe<span class=\"token punctuation\">[</span>aTag<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      tags<span class=\"token punctuation\">.</span><span class=\"token function\">splice</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n      i<span class=\"token operator\">--</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      dedupe<span class=\"token punctuation\">[</span>aTag<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> tags\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>it takes some time to brain-parse this function, it seems to work but it has a potential bug: it changes the reference of the argument passed in.</p>\n<h3>impurity</h3>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\">// ['tag1', 'tag2', 'tag1  '] -> ['tag1', 'tag2']\nfunction clean(tags) {\n<span class=\"token unchanged\">  let dedupe = {};\n  for (let i = 0; i &lt; tags.length; i++){\n</span><span class=\"token deleted-sign deleted\">-    tags[i] = tags[i].trim(); // mutates the tags\n</span><span class=\"token unchanged\">    const aTag = tags[i];\n</span>\n<span class=\"token unchanged\">    if(dedupe[aTag]) {\n</span><span class=\"token deleted-sign deleted\">-      tags.splice(i, 1); // mutates the tags\n</span><span class=\"token unchanged\">      i--;\n    } else {\n      dedupe[aTag] = true;\n    }\n  }\n  return tags;\n</span>}</code></pre></div>\n<p>without mentioning the mysterious <code class=\"language-text\">splice</code> method with a dynamic <code class=\"language-text\">i</code> variable you need to brain-parse, the highlighted 2 lines are directly mutating the argument.</p>\n<p>Imagine the <code class=\"language-text\">tags</code> argument passed in could be used in somewhere else, then this function has a side effect that is really hard to predict and could lead to a bug that is extremely hard to trace.</p>\n<p>This is called <code class=\"language-text\">side effect</code> in functional programming world. and the <code class=\"language-text\">clean</code> function above is defined as <code class=\"language-text\">impure</code></p>\n<h3>pure function</h3>\n<p>So we could come up with a better solution:</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\">// ['tag1', 'tag2', 'tag1  '] -> ['tag1', 'tag2']\nfunction clean(tags) {\n<span class=\"token unchanged\">  let dedupe = {};\n</span><span class=\"token inserted-sign inserted\">+ let result = [];\n</span><span class=\"token unchanged\">  for (let i = 0; i &lt; tags.length; i++){\n</span><span class=\"token deleted-sign deleted\">-   tags[i] = tags[i].trim(); // mutates the tags\n</span><span class=\"token inserted-sign inserted\">+   const aTag = tags[i].trim();\n</span>\n<span class=\"token unchanged\">    if(dedupe[aTag]) {\n</span><span class=\"token deleted-sign deleted\">-     tags.splice(i, 1); // mutates the tags\n-     i--;\n</span><span class=\"token inserted-sign inserted\">+     result.push(aTag);\n</span><span class=\"token unchanged\">    } else {\n      dedupe[aTag] = true;\n    }\n  }\n  return tags;\n</span>}</code></pre></div>\n<p>with this implementation, at least we have get rid of the side effects and eliminated a potential caused by direct data mutation, but we could still do better:</p>\n<h3>Concatenated loops</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1d9161da5cd407fb24234002bcebca06/709ce/loop-patterns.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.66280752532561%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACB0lEQVQ4y3WTe2/aMBTF+/0/zFRN6rZ/hkqFxmihdBAYaUp4JIRAQt4hjvM4u3aVqWzhIuvajvPD59ybm7quIaIoCuR5jrIs0YTneeAFB68YgtjHKXCRsQhlcELsHFBQrrKzPNtwbprJzrJgmCYWiwVm87ncW6/XeFtqBMwRhRG0tyVlF+fAw33vBwLXBXKGug04J4hhGJhMJug+PCDLMnzvdDAcDcH4GYPBAF++foPrWEj9Ez7d3mKlvV4HMsZQVdVfuWLd6/XwPB6BlzlWqzXG4xf43gG+beFxNIJtGuBx1C7ZPhxgkmQBEiHgs9kMS32JvGRwSZ5C6yT2sF/r+KUo0NUF8ii8BMoFvdwhef1+H2mSyAeiONPpFObOACsyKAS473bhnfawNysMnoaYkB08idtv+KppVICl9E4eoJ+AeL6HCqWcC2+9k42NpuLz3R2U8TMBr0jWdV1KboJzDmNrIEljiTfNHX4vVClZFOXn4xPUmXIpmcZN41dCUkUfNn8g9sS8KDnKuoDjOLK1Cp4SJMBcVbHfbsCuFaXZbEYTVV3KKod+SBUOkZ1phD5eJlMcrR0KsoS6//KGbaD39XtmxRnH1IaTHQkYyK9D39DtKNd0S2pg2YutwH+hTd7HFrYRvchzZO6R/N0goVxl6f8etsVH2MU+ecvjEKnngpOXNX3rH8/9AWGi4dXr0X5xAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Loop Pattners\"\n        title=\"Loop Pattners\"\n        src=\"/static/1d9161da5cd407fb24234002bcebca06/11d19/loop-patterns.png\"\n        srcset=\"/static/1d9161da5cd407fb24234002bcebca06/40714/loop-patterns.png 200w,\n/static/1d9161da5cd407fb24234002bcebca06/a8246/loop-patterns.png 400w,\n/static/1d9161da5cd407fb24234002bcebca06/11d19/loop-patterns.png 800w,\n/static/1d9161da5cd407fb24234002bcebca06/f0628/loop-patterns.png 1200w,\n/static/1d9161da5cd407fb24234002bcebca06/709ce/loop-patterns.png 1382w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>As illustrated in the image above, generally a good practice is try to wring <code class=\"language-text\">Concatenated loop</code>.</p>\n<p>To achieve this goal, we could follow a simple rule:</p>\n<blockquote>\n<p>Inside loop, try to do only 1 thing</p>\n</blockquote>\n<p>try to apply that to the <code class=\"language-text\">clean</code> function, we could get</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ['tag1', 'tag2', 'tag1'] -> ['tag1', 'tag2']</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">clean</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tags</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> dedupe <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> tags<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    dedupe<span class=\"token punctuation\">[</span>tags<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> tags<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>dedupe<span class=\"token punctuation\">[</span>tags<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      result<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>tags<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> result\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here inside those 2 loops, we could easily figure out what they are doing respectively.</p>\n<h3>Lazy evaluation</h3>\n<p>However, some people may ask: this is a <code class=\"language-text\">O(2n)</code> compared to the previous <code class=\"language-text\">O(n)</code> function.</p>\n<p>Here will introduce the killer feature of <code class=\"language-text\">lodash</code> - chainable api</p>\n<p>it is basically implemented using <code class=\"language-text\">_.chain(collection)</code> method, or <code class=\"language-text\">_(collection)</code> as a shorthand, and could be optimized easily</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">_</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>func1<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>func2<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>func3<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>is transformed to something like following in normal mode.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  temp1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  temp2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  temp3 <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> source<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  temp1<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">func1</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> source<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  temp2<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">func2</span><span class=\"token punctuation\">(</span>temp1<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> source<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  temp3<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">func3</span><span class=\"token punctuation\">(</span>temp2<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nresult <span class=\"token operator\">=</span> temp3</code></pre></div>\n<p>But in the lazy mode (could be accomplished with <code class=\"language-text\">lazy.js</code>):</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> source<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  result<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">func3</span><span class=\"token punctuation\">(</span><span class=\"token function\">func2</span><span class=\"token punctuation\">(</span><span class=\"token function\">func1</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>as you could see, <code class=\"language-text\">O(kn)</code> algorithm has been optimized to <code class=\"language-text\">O(n)</code>. With pure <code class=\"language-text\">for</code> loop, this optimization is not easy to be achived, but with <code class=\"language-text\">lodash</code> and a sequence of function transformation, this could be easily achieved.</p>\n<h3>Lodash Chainable API: rewrite <code class=\"language-text\">clean</code> function</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ['tag1', 'tag2  ', 'tag1 '] -> ['tag1', 'tag2']</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">clean</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tags</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">_</span><span class=\"token punctuation\">(</span>tags<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span>trim<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">uniq</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>this is so much cleaner than the first version of above!</p>\n<p>read the documentation on <a href=\"https://lodash.com/docs/4.17.2#chain\">lodash chain</a> for more black magic</p>\n<h2><code class=\"language-text\">mergeAndOverwrite</code> function</h2>\n<p>consider the function below:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">mergeAndOverwrite</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">target<span class=\"token punctuation\">,</span> source</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  target <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">merge</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">cloneDeep</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> source<span class=\"token punctuation\">.</span>merge<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> config_key <span class=\"token keyword\">in</span> source<span class=\"token punctuation\">.</span>overwrite<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">.</span>overwrite<span class=\"token punctuation\">.</span><span class=\"token function\">hasOwnProperty</span><span class=\"token punctuation\">(</span>config_key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      target<span class=\"token punctuation\">[</span>config_key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> source<span class=\"token punctuation\">.</span>overwrite<span class=\"token punctuation\">[</span>config_key<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> target\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>there are 2 gotchas:</p>\n<ol>\n<li>1st parameter in <code class=\"language-text\">_.merge</code> could be an empty object, and <code class=\"language-text\">_.merge</code> is a recursive deep operation already, so <code class=\"language-text\">_.cloneDeep</code> is somewhat a cumbersome call.</li>\n<li>the for ... in loop could be entirely replaced by <code class=\"language-text\">Object.assign</code></li>\n</ol>\n<h3>_.merge vs Object.assign</h3>\n<p>Those 2 functions are similar but do things in totally different ways:</p>\n<ol>\n<li>.merge is a recursive call, so it traverses <strong>every</strong> property all object and merge them</li>\n<li>Object.assign only overwrite the 1st layer of right hand-side to left hands-side</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// => { \"a\": { \"a\": \"a\",\"b\":\"bb\" }}</span>\n_<span class=\"token punctuation\">.</span><span class=\"token function\">merge</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> a<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> a<span class=\"token punctuation\">:</span> <span class=\"token string\">'a'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> a<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> b<span class=\"token punctuation\">:</span> <span class=\"token string\">'bb'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// => { \"a\": { \"b\": \"bb\" }}</span>\nObject<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> a<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> a<span class=\"token punctuation\">:</span> <span class=\"token string\">'a'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> a<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> b<span class=\"token punctuation\">:</span> <span class=\"token string\">'bb'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// => { \"a\": [ \"bb\" ] }</span>\n_<span class=\"token punctuation\">.</span><span class=\"token function\">merge</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> a<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> a<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'bb'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// => { \"a\": [ \"bb\" ] }</span>\nObject<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> a<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> a<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'bb'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>rewrite the <code class=\"language-text\">mergeAndOverwrite</code> function</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">mergeAndOverwrite</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">target<span class=\"token punctuation\">,</span> source</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> merged <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">merge</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">,</span> source<span class=\"token punctuation\">.</span>merge<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span>merged<span class=\"token punctuation\">,</span> source<span class=\"token punctuation\">.</span>overwrite<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"tip\">\nRead through Lodash doc before using \\_.cloneDeep\n</div>\n<h2>Final challenge: indentation hell</h2>\n<p>To wrap up, consider the following function</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">filterAck</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">acl_hash</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 0</span>\n  <span class=\"token keyword\">let</span> filtered_api_acl <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> api_version <span class=\"token keyword\">in</span> acl_hash<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 1</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>acl_hash<span class=\"token punctuation\">.</span><span class=\"token function\">hasOwnProperty</span><span class=\"token punctuation\">(</span>api_version<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 2</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>api_key<span class=\"token punctuation\">.</span>default_user_api_acl<span class=\"token punctuation\">[</span>api_version<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 3</span>\n        filtered_api_acl<span class=\"token punctuation\">[</span>api_version<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>acl_hash<span class=\"token punctuation\">[</span>api_version<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// 4</span>\n          <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> acl_hash<span class=\"token punctuation\">[</span>api_version<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 5</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n              config<span class=\"token punctuation\">.</span>api_key<span class=\"token punctuation\">.</span>default_user_api_acl<span class=\"token punctuation\">[</span>api_version<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>\n                acl_hash<span class=\"token punctuation\">[</span>api_version<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n              <span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n            <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token comment\">// 6</span>\n              filtered_api_acl<span class=\"token punctuation\">[</span>api_version<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>acl_hash<span class=\"token punctuation\">[</span>api_version<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> filtered_api_acl\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"tip\">\nWe human beings are not good at reading deeply nested indentation hells: Research shows we only have 7 buffers for short term memory... So code like below will literally burn our brain out.\n</div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 720px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6644ee635b213186f78e9d98b03d074a/7eb62/indentation-hell.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.97222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe0miqP/xAAXEAADAQAAAAAAAAAAAAAAAAAAEBEh/9oACAEBAAEFAiqbF//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABoQAQADAAMAAAAAAAAAAAAAAAEQESEAMUH/2gAIAQEAAT8hUtB01OCYKqve5f/aAAwDAQACAAMAAAAQEw//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEAAgIDAAAAAAAAAAAAAAABABEQcSFBUf/aAAgBAQABPxARsLQhl8VqDZCS30W1gDvH/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Indentation Hell\"\n        title=\"Indentation Hell\"\n        src=\"/static/6644ee635b213186f78e9d98b03d074a/7eb62/indentation-hell.jpg\"\n        srcset=\"/static/6644ee635b213186f78e9d98b03d074a/9c38a/indentation-hell.jpg 200w,\n/static/6644ee635b213186f78e9d98b03d074a/28275/indentation-hell.jpg 400w,\n/static/6644ee635b213186f78e9d98b03d074a/7eb62/indentation-hell.jpg 720w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Whenever writing code, try your best to keep the indentation level &#x3C;= 3 is generally a good practice, <strong>this could vastly improve maintainability of code.</strong></p>\n<h3>1. use <code class=\"language-text\">Object.keys</code> to iterate an object</h3>\n<p>indentation level <code class=\"language-text\">-1</code>, current <code class=\"language-text\">5</code></p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\">function filterAck(acl_hash) {\n<span class=\"token unchanged\">  let filtered_api_acl = {};\n</span><span class=\"token deleted-sign deleted\">- for (let api_version in acl_hash) {\n-   if (acl_hash.hasOwnProperty(api_version)) {\n</span><span class=\"token inserted-sign inserted\">+ Object.keys(acl_hash).forEach(api_version => {\n</span><span class=\"token deleted-sign deleted\">-     if (config.api_key.default_user_api_acl[api_version]) {\n</span><span class=\"token inserted-sign inserted\">+   if (config.api_key.default_user_api_acl[api_version]) {\n</span><span class=\"token deleted-sign deleted\">-       filtered_api_acl[api_version] = [];\n</span><span class=\"token inserted-sign inserted\">+     filtered_api_acl[api_version] = [];\n</span><span class=\"token deleted-sign deleted\">-       if (_.isArray(acl_hash[api_version])) {\n</span><span class=\"token inserted-sign inserted\">+     if (_.isArray(acl_hash[api_version])) {\n</span><span class=\"token deleted-sign deleted\">-         for (let i = 0; i &lt; acl_hash[api_version].length; i++) {\n</span><span class=\"token inserted-sign inserted\">+       for (let i = 0; i &lt; acl_hash[api_version].length; i++) {\n</span><span class=\"token deleted-sign deleted\">-           if (config.api_key.default_user_api_acl[api_version].indexOf(acl_hash[api_version][i]) !== -1) {\n</span><span class=\"token inserted-sign inserted\">+         if (config.api_key.default_user_api_acl[api_version].indexOf(acl_hash[api_version][i]) !== -1) {\n</span><span class=\"token deleted-sign deleted\">-             filtered_api_acl[api_version].push(acl_hash[api_version][i]);\n</span><span class=\"token unchanged\">            // 5\n</span><span class=\"token inserted-sign inserted\">+           filtered_api_acl[api_version].push(acl_hash[api_version][i]);\n</span><span class=\"token deleted-sign deleted\">-           }\n</span><span class=\"token inserted-sign inserted\">+         }\n</span><span class=\"token deleted-sign deleted\">-         }\n</span><span class=\"token inserted-sign inserted\">+       }\n</span><span class=\"token deleted-sign deleted\">-       }\n</span><span class=\"token inserted-sign inserted\">+     }\n</span><span class=\"token deleted-sign deleted\">-     }\n</span><span class=\"token inserted-sign inserted\">+   }\n</span><span class=\"token deleted-sign deleted\">- }\n</span><span class=\"token inserted-sign inserted\">+ });\n</span><span class=\"token unchanged\">  return filtered_api_acl;\n</span>}</code></pre></div>\n<h3>2. use <code class=\"language-text\">_.intersction</code> to simplify replace the inner loop</h3>\n<p>indentation level <code class=\"language-text\">-2</code>, current: <code class=\"language-text\">3</code></p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\">function filterAcl(acl_hash) {\n<span class=\"token unchanged\">  let filtered_api_acl = {};\n  Object.keys(acl_hash).forEach(api_version => {\n    if (config.api_key.default_user_api_acl[api_version]) {\n</span><span class=\"token inserted-sign inserted\">+     filtered_api_acl[api_version] = [];\n</span><span class=\"token unchanged\">      if (_.isArray(acl_hash[api_version])) {\n</span><span class=\"token deleted-sign deleted\">-       for (let i = 0; i &lt; acl_hash[api_version].length; i++) {\n-         if (config.api_key.default_user_api_acl[api_version].indexOf(acl_hash[api_version][i]) !== -1) {\n-           filtered_api_acl[api_version].push(acl_hash[api_version][i]);\n-         }\n-       }\n</span><span class=\"token unchanged\">        // 3\n</span><span class=\"token inserted-sign inserted\">+       filtered_api_acl[api_version] = _.intersction(\n+         config.api_key.default_user_api_acl[api_version],\n+         acl_hash\n+       )\n</span><span class=\"token unchanged\">      }\n    }\n  })\n  return filtered_api_acl;\n</span>}</code></pre></div>\n<h3>3. return in advance to reduce indentation level</h3>\n<p>indentation level <code class=\"language-text\">-1</code>, current <code class=\"language-text\">2</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">filterAcl</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">acl_hash</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> filtered_api_acl <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>acl_hash<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">api_version</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>config<span class=\"token punctuation\">.</span>api_key<span class=\"token punctuation\">.</span>default_user_api_acl<span class=\"token punctuation\">[</span>api_version<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 2</span>\n      <span class=\"token keyword\">return</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>acl_hash<span class=\"token punctuation\">[</span>api_version<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span>\n    <span class=\"token punctuation\">}</span>\n\n    filtered_api_acl<span class=\"token punctuation\">[</span>api_version<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n    filtered_api_acl<span class=\"token punctuation\">[</span>api_version<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">intersection</span><span class=\"token punctuation\">(</span>\n      config<span class=\"token punctuation\">.</span>api_key<span class=\"token punctuation\">.</span>default_user_api_acl<span class=\"token punctuation\">[</span>api_version<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      acl_hash<span class=\"token punctuation\">[</span>api_version<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> filtered_api_acl\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>4. final step: use lodash to wrap everything</h3>\n<p>indentation level <code class=\"language-text\">-2</code>, current <code class=\"language-text\">0</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">filterAcl</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">acl_hash</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">chain</span><span class=\"token punctuation\">(</span>Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>acl_hash<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">api_version</span> <span class=\"token operator\">=></span> config<span class=\"token punctuation\">.</span>api_key<span class=\"token punctuation\">.</span>default_user_api_acl<span class=\"token punctuation\">[</span>api_version<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">api_version</span> <span class=\"token operator\">=></span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>acl_hash<span class=\"token punctuation\">[</span>api_version<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">api_version</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n      api_version<span class=\"token punctuation\">,</span>\n      _<span class=\"token punctuation\">.</span><span class=\"token function\">intersection</span><span class=\"token punctuation\">(</span>\n        config<span class=\"token punctuation\">.</span>api_key<span class=\"token punctuation\">.</span>default_user_api_acl<span class=\"token punctuation\">,</span>\n        acl_hash<span class=\"token punctuation\">[</span>api_version<span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">fromPairs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Final Words</h2>\n<div class=\"tip\">\nUse Lodash!\n</div>\n<h4>references:</h4>\n<ul>\n<li><a href=\"https://lodash.com/docs/4.17.2\">lodash-doc</a></li>\n<li><a href=\"http://philosopherdeveloper.com/posts/introducing-lazy-js.html\">lazy-js-intro</a></li>\n<li><a href=\"http://stackoverflow.com/questions/500504/why-is-using-for-in-with-array-iteration-a-bad-idea\">for-in-stackoverflow</a></li>\n<li><a href=\"https://laracasts.com/series/simple-rules-for-simpler-code\">simple-rules-for-simple-code</a></li>\n</ul>","frontmatter":{"title":"JavaScript 102"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/blogs/javascript-102"}}}